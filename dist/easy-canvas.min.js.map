{"version":3,"file":"easy-canvas.min.js","sources":["../lib/constants.js","../lib/utils.js","../lib/line.js","../lib/flex-box.js","../lib/tree-node.js","../lib/complete-styles.js","../lib/element.js","../lib/view.js","../lib/text.js","../lib/image.js","../lib/event-manager.js","../lib/canvas-render.js","../lib/weapp-adapter.js","../lib/layer.js","../lib/scroll-view.js","../lib/create-element.js","../lib/index.js"],"sourcesContent":["const DISPLAY = {\n  BLOCK: 'block',\n  INLINE_BLOCK: 'inline-block',\n  INLINE: 'inline', // 用户不能设置inline，text默认为inline\n  FLEX: 'flex',\n  NONE: 'none'\n}\n\nconst WIDTH = {\n  AUTO: 'auto',\n  OUTER: '100%'\n}\n\nconst POSITION = {\n  ABSOLUTE: 'absolute',\n  FIXED: 'fixed',\n  RELATIVE: 'relative',\n  STATIC: 'static'\n}\n\nconst TEXT_ALIGN = {\n  LEFT: 'left',\n  RIGHT: 'right',\n  CENTER: 'center'\n}\n\nconst FLEX_DIRECTION = {\n  ROW: 'row',\n  COLUMN: 'column'\n}\n\nconst DEFAULT_STYLES = {\n  display: DISPLAY.BLOCK,\n  fontSize: 14,\n  fontWeight: 400,\n  fontFamily: \"Helvetica Neue,Helvetica,PingFang SC,Hiragino Sans GB,Microsoft YaHei\",\n  color: '#000',\n  paddingTop: 0,\n  paddingBottom: 0,\n  paddingLeft: 0,\n  paddingRight: 0,\n  marginTop: 0,\n  marginBottom: 0,\n  marginLeft: 0,\n  marginRight: 0,\n  height: WIDTH.AUTO,\n  borderRadius: 0,\n  lineCap: 'square',\n  flexDirection: FLEX_DIRECTION.ROW,\n  verticalAlign: 'middle',\n  textAlign: 'left',\n  justifyContent: 'flex-start',\n  alignItems: 'flex-start',\n  whiteSpace: 'normal',\n  zIndex: 1,\n  visible: true,\n  position: 'static'\n}\n\nexport default {\n  DISPLAY,\n  WIDTH,\n  POSITION,\n  DEFAULT_STYLES,\n  TEXT_ALIGN,\n  FLEX_DIRECTION\n}\n","export function isExact(num) {\n  return typeof num === 'number'\n}\n\nexport function isAuto(num) {\n  return num === 'auto'\n}\n\nexport function isOuter(num) {\n  if (typeof num !== 'string') return\n  return num.match('%')\n}\n\nexport function parseOuter(num) {\n  let _n = parseInt(num.replace('%', ''))\n  return (isNaN(_n) || _n < 0) ? 0 : (_n / 100)\n}\n\n\nexport function walk(element, callback) {\n  let _continue = false // 是否跳过当前节点以及后面的节点\n  let _next = false // 是否跳过当前节点数，子元素都不会遍历\n  const _callContinue = () => _continue = true\n  const _callNext = () => _next = true\n  if (element != null) {\n    var stack = [];\n    stack.push(element);\n    while (stack.length != 0) {\n      var item = stack.pop();\n      callback(item, _callContinue, _callNext)\n      if (!_next) {\n        var children = item._getChildren();\n        for (var i = children.length - 1; i >= 0; i--) {\n          if (!_continue) {\n            stack.push(children[i]);\n          } else {\n            // 复位\n            _continue = false\n          }\n\n        }\n\n      } else {\n        // 复位\n        _next = false\n      }\n    }\n  }\n}\n\nexport function walkParent(element, callback) {\n  if (!element) return\n  let cur = element\n  let stop = false\n  const callbreak = () => {\n    stop = true\n  }\n  while (cur.parent) {\n    callback(cur.parent, callbreak)\n    if (stop) {\n      break\n    }\n    cur = cur.parent\n  }\n}\n\nexport function findRelativeTo(element) {\n  if (element.isInFlow()) return element.parent\n  if (element.renderStyles.position === 'fixed') return element.root\n  let relativeTo = null\n  walkParent(element, (parent) => {\n    if (parent.renderStyles.position !== 'static' && !relativeTo) {\n      relativeTo = parent\n    }\n  })\n  if (!relativeTo) {\n    relativeTo = element.root\n  }\n  return relativeTo\n}\n\n\n//\nvar pow = Math.pow,\n  sqrt = Math.sqrt,\n  sin = Math.sin,\n  cos = Math.cos,\n  PI = Math.PI,\n  c1 = 1.70158,\n  c2 = c1 * 1.525,\n  c3 = c1 + 1,\n  c4 = (2 * PI) / 3,\n  c5 = (2 * PI) / 4.5;\n\nexport function easeInOutElastic(x) {\n  return x === 0 ? 0 : x === 1 ? 1 : x < 0.5 ?\n    -(pow(2, 20 * x - 10) * sin((20 * x - 11.125) * c5)) / 2 :\n    pow(2, -20 * x + 10) * sin((20 * x - 11.125) * c5) / 2 + 1;\n}\n\nfunction easeInOutExpo(pos) {\n  if (pos === 0) return 0;\n  if (pos === 1) return 1;\n  if ((pos /= 0.5) < 1) return 0.5 * Math.pow(2, 10 * (pos - 1));\n  return 0.5 * (-Math.pow(2, -10 * --pos) + 2);\n}\n\n\nexport function isWX() {\n  return !window\n}\n\nexport function isEndNode(el) {\n  return el.parent && !el.next && !el.hasChildren()\n}\n\nexport function breadthFirstSearch(node) {\n\n  var nodes = [];\n\n  if (node != null) {\n\n    var queue = [];\n\n    queue.unshift(node);\n\n    while (queue.length != 0) {\n\n      var item = queue.shift();\n\n      nodes.push(item._generateRender());\n\n      var children = item._getChildren();\n\n      for (var i = 0; i < children.length; i++)\n        queue.push(children[i]._generateRender());\n\n    }\n\n  }\n\n  return nodes;\n\n}\n\nexport function breadthFirstSearchRight(node) {\n\n  var nodes = [];\n\n  if (node != null) {\n\n    var queue = [];\n\n    queue.unshift(node);\n\n    while (queue.length != 0) {\n\n      var item = queue.shift();\n\n      nodes.push(item._generateRender());\n\n      var children = item._getChildren();\n\n      for (var i = children.length - 1; i >= 0; i--)\n        queue.push(children[i]._generateRender());\n\n    }\n\n  }\n\n  return nodes.reverse();\n\n}\n\nexport function needReflow(style) {\n  return ['width',\n    'height',\n    'position',\n    'display',\n    'padding',\n    'paddingTop',\n    'paddingLeft',\n    'paddingBottom',\n    'paddingRight',\n    'margin',\n    'marginLeft',\n    'marginTop',\n    'marginBottom',\n    'marginRight',\n    'borderWidth',\n    'flexDirection',\n    'justifyContent',\n    'alignItems',\n    'textAlign',\n    'left',\n    'top',\n    'right',\n    'bottom'\n  ].includes(style)\n}\n\nconst mergeKeys = ['attrs', 'styles', 'on']\nexport function mergeOptions(options, mergeOptions) {\n  let mergedOptions = {}\n  mergeKeys.forEach(key => {\n    if (!options[key]) options[key] = {}\n    if (!mergeOptions[key]) mergeOptions[key] = {}\n    mergedOptions[key] = Object.assign({}, options[key], mergedOptions[key])\n  })\n  return mergedOptions\n}\n\n\nexport function floor(val){\n  return (0.5 + val) << 0\n}\n\nexport function qSort3(arr,callback) {       //三路快排\n  if(arr.length == 0) {\n    return [];\n  }\n  var left = [];\n  var center = [];\n  var right = [];\n  var pivot = arr[0];    //偷懒，直接取第一个,实际取值情况 参考[快速排序算法的优化思路总结]\n  let val = 0\n  for(var i = 0; i < arr.length; i++) {\n    val = callback(arr[i],pivot)\n    if(val<0) {\n      left.push(arr[i]);\n    } else if(val === 0) {\n      center.push(arr[i]);\n    } else {\n      right.push(arr[i]);\n    }\n  }\n  return [...qSort3(left,callback), ...center, ...qSort3(right,callback)];\n}\n\nexport function getThrottle(threshold) {\n    let timer;\n    return function (fn) {\n        if (!timer) {\n            timer = setTimeout(function () {\n                fn();\n                timer = null;\n            }, threshold)\n        }\n    }\n}\n","import { isExact, isAuto } from './utils'\n\nexport default class Line {\n  constructor() {\n    this.width = 0\n    this.height = 0\n    this.contentWidth = 0 // 右边界\n    this.y = 0 // 上\n    this.doorClosed = false // 是否允许加入\n    this.outerWidth = 0\n    this.container = null\n    this.elements = []\n    this.start = null // 起点，行最左边第一个\n    this.end = null // 结束\n    this.offsetX = 0\n    this.id = Math.random()\n  }\n\n  bind(el) {\n    this.container = el.parent\n    this.initHeight(el)\n    this.outerWidth = el.parent && isAuto(el.parent.styles.width) ? Infinity : el.parent.renderStyles.contentWidth\n\n    this.start = el\n    this.add(el)\n  }\n\n  initHeight(el) {\n    this.height = el.parent && el.parent.renderStyles.lineHeight || 0\n  }\n\n  initLayout(el) {\n    this.right = el._getContainerLayout().contentX\n    this.x = el._getContainerLayout().contentX\n    this.y = this.getPreLine(el).y\n  }\n\n  refreshElementPosition(el) {\n    if (this.start === el) {\n      this.initLayout(el)\n    }\n    // 刷新位置，首先以左边计算\n    el.x = this.right + this.offsetX\n    el.y = this.y + this.getOffsetY(el)\n    // + (this.height - el.renderStyles.height) / 2\n    this.right += el.renderStyles.width\n\n  }\n\n  getOffsetY(el) {\n    if (el.renderStyles.verticalAlign === 'bottom') {\n      return (this.height - el.renderStyles.height)\n    } else if (el.renderStyles.verticalAlign === 'middle') {\n      return (this.height - el.renderStyles.height) / 2\n    } else {\n      return 0\n    }\n  }\n\n\n  add(el) {\n    this.elements.push(el)\n    el.line = this\n    this.refreshWidthHeight(el)\n\n    if (!el.next || el.next.renderStyles.display !== 'inline-block') {\n      this.closeLine()\n    }\n  }\n\n  refreshWidthHeight(el) {\n    if (el.renderStyles.height > this.height) {\n      this.height = el.renderStyles.height\n    }\n\n    this.width += el.renderStyles.width\n  }\n\n  canIEnter(el) {\n    if ((el.renderStyles.width + this.width) > this.outerWidth) {\n      this.closeLine()\n      return false\n    } else {\n      return true\n    }\n  }\n\n  closeLine() {\n    // new line\n    this.end = this.elements[this.elements.length - 1]\n    this.refreshXAlign()\n\n  }\n\n  getPreLine(el) {\n    if (el.pre) {\n      if (el.pre.line) {\n        return { y: el.pre.line.height + el.pre.line.y, x: el.pre.line.x }\n      } else {\n        return { y: el._getPreLayout().y + el._getPreLayout().height, x: el._getPreLayout().x }\n      }\n    } else {\n      return { y: el._getContainerLayout().contentY, x: el._getContainerLayout().contentX }\n    }\n  }\n\n  refreshXAlign() {\n    if (this.outerWidth > 5000) return\n    if (!this.end.parent) return\n    let offsetX = this.outerWidth - this.width\n    if (this.end.parent.renderStyles.textAlign === 'center') {\n      offsetX = offsetX / 2\n    } else if (this.end.parent.renderStyles.textAlign === 'left') {\n      offsetX = 0\n    }\n    this.offsetX = offsetX\n  }\n}\n","import Line from './line'\nimport { isExact, isAuto } from './utils'\nimport STYLES from './constants'\n\nconst KEY = {\n  [STYLES.FLEX_DIRECTION.ROW]: {\n    width: 'width',\n    contentWidth: 'contentWidth',\n    x: 'x',\n    y: 'y',\n    contentX: 'contentX',\n    height: 'height',\n    contentHeight: 'contentHeight'\n  },\n  [STYLES.FLEX_DIRECTION.COLUMN]: {\n    width: 'height',\n    contentWidth: 'contentHeight',\n    x: 'y',\n    y: 'x',\n    contentX: 'contentY',\n    height: 'width',\n    contentHeight: 'contentWidth'\n  }\n}\n// 目前flex是基于inline-block的简单实现，只支持row方向width + flex混用\nexport default class FlexBox extends Line {\n  constructor() {\n    super()\n    this.exactValue = 0\n    this.flexTotal = 0\n    this.key = null\n  }\n\n  closeLine() {\n    super.closeLine()\n    this.calcFlex()\n  }\n\n  bind(el) {\n    this.container = el.parent\n    if (el.parent) {\n      this.key = KEY[el.parent.renderStyles.flexDirection]\n    }\n    this.initHeight(el)\n    this.outerWidth = el.parent && isAuto(el.parent.styles[this.key.width]) ? Infinity : el.parent.renderStyles[this.key.contentWidth]\n    this.start = el\n    this.add(el)\n  }\n\n  add(el) {\n    if (isExact(el.styles[this.key.width])) {\n      this.exactValue += el.renderStyles[this.key.width]\n    } else if (isExact(el.styles.flex)) {\n      this.flexTotal += el.renderStyles.flex\n    }\n\n    this.elements.push(el)\n    el.line = this\n    this.refreshWidthHeight(el)\n\n    if (!el.next) {\n      this.closeLine()\n    }\n  }\n\n  initHeight() {\n    this[this.key.height] = 0\n  }\n\n  refreshWidthHeight(el) {\n    if (el.renderStyles[this.key.height] > this[this.key.height]) {\n      this[this.key.height] = el.renderStyles[this.key.height]\n    }\n\n    this[this.key.width] += el.renderStyles[this.key.width]\n  }\n\n  initLayout(el) {\n    this.right = el._getContainerLayout()[this.key.contentX]\n    this[this.key.x] = el._getContainerLayout()[this.key.contentX]\n    this[this.key.y] = this.getPreLine(el)[this.key.y]\n  }\n\n  refreshElementPosition(el) {\n    if (this.start === el) {\n      this.initLayout(el)\n    }\n    // 刷新位置，首先以左边计算\n    el[this.key.x] = this.right + this.offsetX\n    el[this.key.y] = this[this.key.y] + this.getOffsetY(el)\n    // + (this.height - el.renderStyles.height) / 2\n    this.right += el.renderStyles[this.key.width]\n\n  }\n\n  calcFlex() {\n    const { [this.key.contentWidth]: containerWidth } = this.container.renderStyles\n    this.elements.forEach(child => {\n      if (isExact(child.styles.flex)) {\n        child.renderStyles[this.key.width] = (child.styles.flex / this.flexTotal) * (containerWidth - this.exactValue)\n        child._refreshContentWithLayout()\n      }\n    })\n  }\n\n  refreshXAlign() {\n    if (!this.end.parent) return\n    let offsetX = this.outerWidth - this[this.key.width]\n    if (this.end.parent.renderStyles.justifyContent === 'center') {\n      offsetX = offsetX / 2\n    } else if (this.end.parent.renderStyles.justifyContent === 'flex-start') {\n      offsetX = 0\n    }\n    this.offsetX = offsetX\n  }\n\n  getOffsetY(el) {\n    if (el.renderStyles.alignSelf === 'flex-end') {\n      return (this.container.renderStyles[this.key.contentHeight] - el.renderStyles[this.key.height])\n    } else if (el.renderStyles.alignSelf === 'center') {\n      return (this.container.renderStyles[this.key.contentHeight] - el.renderStyles[this.key.height]) / 2\n    } else {\n      return 0\n    }\n  }\n}\n","export default class TreeNode {\n\n  static connectChildren(el) {\n    if (el.hasChildren()) {\n      el.children = el.children.filter(item => item instanceof TreeNode)\n      el._getChildren().map((child, index) => {\n        // 设置parent\n        child._setParent(el)\n        // 设置了上一个兄弟节点\n        child._setSibling(el._getChildren()[index - 1], el._getChildren()[index + 1])\n        TreeNode.connectChildren(child)\n      })\n    } else {\n    }\n  }\n\n  constructor(children) {\n    this.children = children || []\n    this.parent = null\n    this.root = null\n    this.pre = null\n    this.next = null\n  }\n\n\n\n  hasChildren() {\n    return Array.isArray(this.children) && this.children.length ? true : false\n  }\n\n  _getChildren() {\n    return this.hasChildren() ? this.children : []\n  }\n\n  _setParent(element) {\n    this.parent = element\n    this.root = element.root\n  }\n\n  _setSibling(pre, next) {\n    this.pre = pre || null\n    this.next = next || null\n  }\n\n\n  // 添加在最后\n  appendChild(treeNode) {\n    if (!treeNode instanceof TreeNode) throw Error('Unknown treeNode type')\n    const pre = this._getChildren()[this._getChildren().length - 1]\n    pre && pre._setSibling(pre.pre, treeNode)\n    this.children.push(treeNode)\n    treeNode._setParent(this)\n    treeNode._setSibling(pre, null)\n    // return treeNode\n  }\n\n  //\n  prependChild(treeNode) {\n    if (!treeNode instanceof TreeNode) throw Error('Unknown treeNode type')\n    const next = this._getChildren()[0]\n    next && next._setSibling(treeNode, next.next)\n    this.children.unshift(treeNode)\n    treeNode._setParent(this)\n    treeNode._setSibling(null, next)\n    // return treeNode\n  }\n\n  removeChild(treeNode) {\n    if (!treeNode instanceof TreeNode) throw Error('Unknown treeNode type')\n    const index = this._getChildren().indexOf(treeNode)\n    if (index < 0) throw Error('treeNode must be the child of parent')\n    const pre = this._getChildren()[index - 1]\n    const next = this._getChildren()[index + 1]\n    if (pre) {\n      pre._setSibling(pre.pre, next)\n    }\n    if (next) {\n      next._setSibling(pre, next.next)\n    }\n    this.children.splice(index, 1)\n  }\n\n  remove() {\n    if (!this.parent) {\n      throw Error('Can not remove root node')\n    }\n    this.parent.removeChild(this)\n  }\n\n  append(treeNode) {\n    if (!treeNode instanceof TreeNode) throw Error('Unknown treeNode type')\n    if (!this.parent) throw Error('Can not add treeNode to root level!')\n    let children = []\n    treeNode._setParent(this.parent)\n    this.parent.children.forEach((child, index) => {\n      children.push(child)\n      if (child === this) {\n        treeNode._setSibling(child, this.parent.children[index + 1])\n        children.push(treeNode)\n      }\n    })\n    this.parent.children = children\n  }\n\n  prepend(treeNode) {\n    if (!treeNode instanceof TreeNode) throw Error('Unknown treeNode type')\n    if (!this.parent) throw Error('Can not add treeNode to root level!')\n    let children = []\n    treeNode._setParent(this.parent)\n    for (let i = this.parent.children.length - 1; i >= 0; i--) {\n      children.unshift(this.parent.children[i])\n      if (this.parent.children[i] === this) {\n        treeNode._setSibling(this.parent.children[i - 1], this.parent.children[i])\n        children.unshift(treeNode)\n      }\n    }\n    this.parent.children = children\n  }\n\n\n}\n","import { isExact, isAuto, isOuter } from './utils'\nimport STYLES from './constants'\n\n\nexport default function (element) {\n  _completeFlex(element)\n\n  _completeWidth(element)\n\n  _completeBorder(element)\n\n  _completeFont(element)\n\n  _completePaddingMargin(element)\n}\n\n\nfunction _completePaddingMargin(element) {\n  if (element.styles.padding) {\n    if (isExact(element.styles.padding)) {\n      element.styles.paddingLeft = element.styles.padding\n      element.styles.paddingBottom = element.styles.padding\n      element.styles.paddingRight = element.styles.padding\n      element.styles.paddingTop = element.styles.padding\n    } else if (Array.isArray(element.styles.padding)) {\n      // 支持数组[10,20]相当于padding:10px 20px;\n      if (element.styles.padding.length === 2) {\n        element.styles.paddingLeft = element.styles.paddingRight = element.styles.padding[1]\n        element.styles.paddingBottom = element.styles.paddingTop = element.styles.padding[0]\n      } else if (element.styles.padding.length === 4) {\n        element.styles.paddingLeft = element.styles.padding[3]\n        element.styles.paddingBottom = element.styles.padding[2]\n        element.styles.paddingRight = element.styles.padding[1]\n        element.styles.paddingTop = element.styles.padding[0]\n      }\n    }\n  }\n\n  if (isExact(element.styles.margin)) {\n    element.styles.marginLeft = element.styles.margin\n    element.styles.marginBottom = element.styles.margin\n    element.styles.marginRight = element.styles.margin\n    element.styles.marginTop = element.styles.margin\n  } else if (Array.isArray(element.styles.margin)) {\n    // 支持数组[10,20]相当于padding:10px 20px;\n    if (element.styles.margin.length === 2) {\n      element.styles.marginLeft = element.styles.marginRight = element.styles.margin[1]\n      element.styles.marginBottom = element.styles.marginTop = element.styles.margin[0]\n    } else if (element.styles.margin.length === 4) {\n      element.styles.marginLeft = element.styles.margin[3]\n      element.styles.marginBottom = element.styles.margin[2]\n      element.styles.marginRight = element.styles.margin[1]\n      element.styles.marginTop = element.styles.margin[0]\n    }\n  }\n}\n\n/**\n * borderwidth到各个边\n */\nfunction _completeBorder(element) {\n  let { borderWidth, borderLeftWidth, borderRightWidth, borderBottomWidth, borderTopWidth, borderRadius } = element.styles\n  if (!borderWidth) {\n    element.styles.borderWidth = 0\n    borderWidth = 0\n  }\n  if (Array.isArray(borderWidth)) {\n    element.styles.borderTopWidth = borderWidth[0]\n    element.styles.borderRightWidth = borderWidth[1]\n    element.styles.borderBottomWidth = borderWidth[2]\n    element.styles.borderLeftWidth = borderWidth[3]\n  } else {\n    if (!borderLeftWidth) {\n      element.styles.borderLeftWidth = borderWidth\n    }\n    if (!borderRightWidth) {\n      element.styles.borderRightWidth = borderWidth\n    }\n    if (!borderBottomWidth) {\n      element.styles.borderBottomWidth = borderWidth\n    }\n    if (!borderTopWidth) {\n      element.styles.borderTopWidth = borderWidth\n    }\n  }\n  if (borderRadius) {\n    element.styles.overflow = 'hidden'\n  }\n}\n\nfunction _completeWidth(element) {\n  if (!element.styles.width) {\n    if (element.styles.display === STYLES.DISPLAY.INLINE_BLOCK || element.styles.display === STYLES.DISPLAY.INLINE || !element.isInFlow()) {\n      element.styles.width = STYLES.WIDTH.AUTO\n    } else if (element.styles.display === STYLES.DISPLAY.BLOCK || element.styles.display === STYLES.DISPLAY.FLEX) {\n      element.styles.width = STYLES.WIDTH.OUTER\n    } else {\n      element.styles.width = 0\n    }\n  }\n\n  if (isOuter(element.styles.width)) {\n    if (element.parent && isAuto(element.parent.styles.width)) {\n      element.styles.width = STYLES.WIDTH.AUTO\n    }\n  }\n\n  if (isOuter(element.styles.height)) {\n    if (element.parent && isAuto(element.parent.styles.height)) {\n      element.styles.height = STYLES.WIDTH.AUTO\n    }\n  }\n}\n\nfunction _completeFont(element) {\n  if (element.styles.fontSize && !element.styles.lineHeight) {\n    element.styles.lineHeight = element.styles.fontSize * 1.4\n  }\n}\n\nfunction _completeFlex(element) {\n  if (element.parent && element.parent.styles.display === STYLES.DISPLAY.FLEX) {\n    // flex布局内 width 和flex需要有一个\n    if (!element.styles.flex) {\n      if (!isExact(element.styles.height) && !isExact(element.styles.width)) {\n        element.styles.flex = 1\n      }\n    } else {\n      if (element.parent.styles.flexDirection === 'column' && isExact(element.styles.flex)) {\n        element.styles.height = 0\n      } else if (element.parent.styles.flexDirection === 'row' && isExact(element.styles.flex)) {\n        element.styles.width = 0\n      }\n    }\n\n  }\n}\n","import STYLES from './constants'\nimport pxUtil from './px'\nimport { isExact, walk, isOuter, parseOuter, walkParent, isEndNode, isAuto, findRelativeTo, needReflow, floor } from './utils'\nimport Line from './line'\nimport FlexBox from './flex-box'\nimport TreeNode from './tree-node'\nimport completeStyles from './complete-styles'\n\n/**\n * Element类实现盒模型以及定位，不具备绘制\n * 其他类继承实现\n *\n */\n\n\n\n\nexport default class Element extends TreeNode {\n  constructor(options, children) {\n    super(children)\n    this.options = Object.assign({ attrs: {}, styles: {}, on: {} }, options)\n    this.styles = null\n    this.renderStyles = null\n    this.x = 0\n    this.y = 0\n    this.render = null\n    this.container = null\n    this.visible = true\n  }\n\n  init() {\n    this._initStyles()\n    this.initEvent()\n  }\n\n  initEvent() {\n    if (this.options.on) {\n      Object.keys(this.options.on).forEach(eventName => {\n        if (this.getLayer().eventManager.EVENTS.includes(eventName)) {\n          this.getLayer().eventManager.addEventListener(eventName, this.options.on[eventName], this)\n        }\n      })\n    }\n  }\n\n  removeEvent() {\n    this.getLayer().eventManager.removeElement(this)\n  }\n\n  getLayer() {\n    return this.root.layer\n  }\n\n  getRender() {\n    return this.root.layer.render\n  }\n\n  _paint() {\n\n  }\n\n  mount(layer) {\n    layer.mountNode(this)\n  }\n\n  _initStyles() {\n    this.styles = Object.assign({}, this._getDefaultStyles(), this._getParentStyles(this.options.styles), this.options.styles || {})\n\n    this._completeStyles()\n\n    this._initRenderStyles()\n  }\n\n  _initRenderStyles() {\n    const renderStyles = { ...this.styles }\n    const parentWidth = this._getContainerLayout().contentWidth\n    const parentHeight = this._getContainerLayout().contentHeight\n\n    if (isAuto(renderStyles.width)) {\n      renderStyles.paddingWidth = 0\n    } else if (isOuter(renderStyles.width)) {\n      renderStyles.paddingWidth = parseOuter(renderStyles.width) * parentWidth - renderStyles.marginLeft - renderStyles.marginRight\n    } else {\n      renderStyles.paddingWidth = renderStyles.width\n    }\n\n    if (isAuto(renderStyles.height)) {\n      renderStyles.paddingHeight = 0\n    } else if (isOuter(renderStyles.height)) {\n      renderStyles.paddingHeight = parseOuter(renderStyles.height) * parentHeight - renderStyles.marginTop - renderStyles.marginBottom\n    } else {\n      renderStyles.paddingHeight = renderStyles.height\n    }\n\n    if (!renderStyles.paddingWidth) renderStyles.paddingWidth = 0\n    if (!renderStyles.paddingHeight) renderStyles.paddingHeight = 0\n\n    // 初始化contentWidth\n    renderStyles.contentWidth = renderStyles.paddingWidth - renderStyles.paddingLeft - renderStyles.paddingRight\n    renderStyles.contentHeight = renderStyles.paddingHeight - renderStyles.paddingTop - renderStyles.paddingBottom\n\n    renderStyles.width = renderStyles.paddingWidth + renderStyles.marginLeft + renderStyles.marginRight + this._getTotalBorderWidth(renderStyles)\n    renderStyles.height = renderStyles.paddingHeight + renderStyles.marginTop + renderStyles.marginBottom + this._getTotalBorderHeight(renderStyles)\n\n    this.renderStyles = renderStyles\n\n    if (this._InFlexBox()) {\n      this._bindFlexBox()\n    } else if (!this.isInFlow()) {\n      this.relativeTo = findRelativeTo(this)\n    }\n\n\n  }\n\n  /**\n   * 需要继承的styles放在这里\n   */\n  _getParentStyles(curStyles) {\n    let { textAlign, lineHeight, fontSize, color, fontFamily, alignItems, visible = true } = this.parent && this.parent.renderStyles || {}\n    let extendStyles = {}\n    if (textAlign) extendStyles.textAlign = textAlign\n    if (fontSize) extendStyles.fontSize = fontSize\n    if (color) extendStyles.color = color\n    if (fontFamily) extendStyles.fontFamily = fontFamily\n    if (alignItems && !curStyles.alignSelf) extendStyles.alignSelf = alignItems\n    extendStyles.visible = visible\n    return extendStyles\n  }\n\n  _completeStyles() {\n    completeStyles(this)\n  }\n\n  _getDefaultStyles() {\n    return STYLES.DEFAULT_STYLES\n  }\n\n  // 获取文档流中的子节点\n  _getChildrenInFlow() {\n    return this._getChildren().filter(item => item.isInFlow())\n  }\n\n  // 是否在文档流中\n  isInFlow() {\n    const { position, display } = this.styles\n    return position !== STYLES.POSITION.ABSOLUTE && position !== STYLES.POSITION.FIXED\n  }\n\n  isVisible() {\n    return this.renderStyles.visible && this.visible\n  }\n\n  _generateRender() {\n    return this\n  }\n\n  getCtx() {\n    return this.root.layer.ctx\n  }\n\n  /**\n   * 实现文档流 需要知道上一个兄弟节点\n   */\n  _reflow() {\n\n\n  }\n\n  _initWidthHeight() {\n    const { width, height, display, flex, marginLeft, marginRight, marginTop, marginBottom } = this.styles\n    if (isAuto(width) || isAuto(height)) {\n      // 这一步需要遍历，判断一下\n      const layout = this._measureLayout()\n      // 初始化宽度高度\n      if (isAuto(width)) {\n        this.renderStyles.contentWidth = floor(layout.width)\n      }\n\n      if (isAuto(height)) {\n        // 不填就是auto\n        this.renderStyles.contentHeight = floor(layout.height)\n      }\n    }\n\n    this._refreshLayoutWithContent()\n\n    if (this._InFlexBox()) {\n      this.line.refreshWidthHeight(this)\n    } else if (display === STYLES.DISPLAY.INLINE_BLOCK) {\n      // 如果是inline-block  这里仅计算高度\n      this._bindLine()\n    }\n  }\n\n  _initPosition() {\n    let { contentX } = this._getContainerLayout()\n    const { paddingLeft, paddingTop, borderLeftWidth, borderTopWidth, marginLeft, marginTop } = this.renderStyles\n    // 初始化ctx位置\n    if (!this.isInFlow()) {\n      // 不在文档流中\n      let { contentX, contentY, contentWidth, contentHeight } = this._getContainerLayout(this.relativeTo)\n      let { top, bottom, right, left, width, height } = this.renderStyles\n      if (isOuter(top)) top = parseOuter(top) * contentHeight\n      if (isOuter(bottom)) bottom = parseOuter(bottom) * contentHeight\n      if (isOuter(left)) left = parseOuter(left) * contentWidth\n      if (isOuter(right)) right = parseOuter(right) * contentWidth\n      if (isExact(top)) {\n        this.y = contentY + top\n      } else if (isExact(bottom)) {\n        this.y = contentY + contentHeight - bottom - height\n      }\n\n      if (isExact(left)) {\n        this.x = contentX + left\n      } else if (isExact(right)) {\n        this.x = contentX + contentWidth - right - width\n      }\n    } else if (this._InFlexBox()) {\n      this.line.refreshElementPosition(this)\n    } else if (this.renderStyles.display === STYLES.DISPLAY.INLINE_BLOCK) {\n      // inline-block到line里计算\n      // this._bindLine()\n      this.line.refreshElementPosition(this)\n    } else {\n      this.x = contentX\n      this.y = this._getPreLayout().y + this._getPreLayout().height\n    }\n    this.x = floor(this.x)\n    this.y = floor(this.y)\n    this.contentX = this.x + paddingLeft + borderLeftWidth + marginLeft\n    this.contentY = this.y + paddingTop + borderTopWidth + marginTop\n  }\n\n  _InFlexBox() {\n    if (!this.isInFlow()) return false\n    if (!this.parent) return false\n    if (this.parent && this.parent.renderStyles.display === STYLES.DISPLAY.FLEX) return true\n  }\n\n\n  // 父元素根据子元素撑开content后，再计算width\n  _refreshLayoutWithContent() {\n    this.renderStyles.height = floor(this.renderStyles.contentHeight + this.renderStyles.paddingTop + this.renderStyles.paddingBottom + this.renderStyles.marginTop + this.renderStyles.marginBottom + this._getTotalBorderHeight())\n    this.renderStyles.width = floor(this.renderStyles.contentWidth + this.renderStyles.paddingLeft + this.renderStyles.paddingRight + this.renderStyles.marginLeft + this.renderStyles.marginRight + this._getTotalBorderWidth())\n    this.renderStyles.paddingWidth = floor(this.renderStyles.contentWidth + this.renderStyles.paddingLeft + this.renderStyles.paddingRight)\n    this.renderStyles.paddingHeight = floor(this.renderStyles.contentHeight + this.renderStyles.paddingTop + this.renderStyles.paddingBottom)\n  }\n\n  // 父元素根据子元素撑开content后，再计算width\n  _refreshContentWithLayout() {\n    this.renderStyles.contentHeight = this.renderStyles.height - this.renderStyles.paddingTop - this.renderStyles.paddingBottom - this.renderStyles.marginTop - this.renderStyles.marginBottom - this._getTotalBorderHeight()\n    this.renderStyles.contentWidth = this.renderStyles.width - this.renderStyles.paddingLeft - this.renderStyles.paddingRight - this.renderStyles.marginLeft - this.renderStyles.marginRight - this._getTotalBorderWidth()\n    this.renderStyles.paddingWidth = floor(this.renderStyles.contentWidth + this.renderStyles.paddingLeft + this.renderStyles.paddingRight)\n    this.renderStyles.paddingHeight = floor(this.renderStyles.contentHeight + this.renderStyles.paddingTop + this.renderStyles.paddingBottom)\n  }\n\n  _getTotalBorderWidth(renderStyles = this.renderStyles) {\n    return renderStyles.borderLeftWidth + renderStyles.borderRightWidth\n  }\n\n  _getTotalBorderHeight(renderStyles = this.renderStyles) {\n    return renderStyles.borderTopWidth + renderStyles.borderBottomWidth\n  }\n\n  _bindLine() {\n    if (this.pre && this.pre.line && this.pre.line.canIEnter(this)) {\n      this.pre.line.add(this)\n    } else {\n      // 新行\n      new Line().bind(this)\n    }\n  }\n\n  _bindFlexBox() {\n    if (this.pre && this.pre.line) {\n      this.pre.line.add(this)\n    } else {\n      // 新行\n      new FlexBox().bind(this)\n    }\n  }\n\n  _getContainerLayout(container = this.parent) {\n    if (!container) {\n      // root\n      if (!this.container) {\n        debugger\n      }\n      container = {\n        renderStyles: {\n          width: this.container.width,\n          height: this.container.height,\n          paddingTop: 0,\n          paddingBottom: 0,\n          paddingLeft: 0,\n          paddingRight: 0,\n          marginLeft: 0,\n          marginRight: 0,\n          marginTop: 0,\n          marginBottom: 0,\n          contentWidth: this.container.width,\n          contentHeight: this.container.height\n        },\n        x: 0,\n        y: 0,\n        contentX: 0,\n        contentY: 0\n      }\n    }\n    return {\n      width: container.renderStyles.width,\n      height: container.renderStyles.height,\n      x: container.x,\n      y: container.y,\n      paddingTop: container.renderStyles.paddingTop,\n      paddingBottom: container.renderStyles.paddingBottom,\n      paddingLeft: container.renderStyles.paddingLeft,\n      paddingRight: container.renderStyles.paddingRight,\n      marginLeft: container.renderStyles.marginLeft,\n      marginRight: container.renderStyles.marginRight,\n      marginTop: container.renderStyles.marginTop,\n      marginBottom: container.renderStyles.marginBottom,\n      contentX: container.contentX,\n      contentY: container.contentY,\n      contentWidth: container.renderStyles.contentWidth,\n      contentHeight: container.renderStyles.contentHeight\n    }\n  }\n\n  // 这里前一个节点必须在文档流中\n  _getPreLayout() {\n    let cur = this.pre\n    while (cur && !cur.isInFlow()) {\n      cur = cur.pre\n    }\n    // 如果没有前一个或者前面的都不在文档流中，获取容器的\n    if (cur) {\n      return {\n        width: cur.renderStyles.width,\n        height: cur.renderStyles.height,\n        x: cur.x,\n        y: cur.y\n      }\n    } else {\n      return {\n        width: 0,\n        height: 0,\n        x: this._getContainerLayout().contentX,\n        y: this._getContainerLayout().contentY\n      }\n    }\n  }\n\n  // 计算自身的高度\n  _measureLayout() {\n    let width = 0 // 需要考虑原本的宽度\n    let height = 0\n    this._getChildrenInFlow().forEach(child => {\n      if (child.line) {\n        if (child.line.start === child) {\n          if (child.line.width > width) {\n            width = child.line.width\n          }\n          height += child.line.height\n        }\n      } else if (child.renderStyles.width > width) {\n        width = child.renderStyles.width\n        height += child.renderStyles.height\n      } else {\n        height += child.renderStyles.height\n      }\n    })\n\n    return { width, height }\n  }\n\n  // 获取元素，只会找该元素子级\n  getElementBy(key, value) {\n    let match = []\n    walk(this, (element) => {\n      if (element.options.attrs[key] === value) {\n        match.push(element)\n      }\n    })\n    return match\n  }\n\n  // 添加在最后\n  appendChild(element) {\n    super.appendChild(element)\n    this.getLayer().onElementAdd(element)\n    return element\n  }\n\n  //\n  prependChild(element) {\n    super.prependChild(element)\n    this.getLayer().onElementAdd(element)\n    return element\n  }\n\n  removeChild(element) {\n    super.removeChild(element)\n    this.getLayer().onElementRemove(element)\n  }\n\n  append(element) {\n    super.append(element)\n    this.getLayer().onElementAdd(element)\n  }\n\n  prepend(element) {\n    super.prepend(element)\n    this.getLayer().onElementAdd(element)\n  }\n\n  setStyles(styles) {\n    let _needReflow = false\n    Object.keys(styles).forEach(key => {\n      if (needReflow(key)) {\n        _needReflow = true\n      } else {\n        this.renderStyles[key] = styles[key]\n      }\n    })\n    if (_needReflow) {\n      Object.keys(styles).forEach(key => {\n        this.options.styles[key] = styles[key]\n      })\n      this.getLayer().reflowElement(this, this)\n      // console.warn('实验性功能')\n    } else {\n      this.getRender().requestRepaint()\n    }\n  }\n\n}\n","import Element from './element'\nimport STYLES from './constants'\nimport { isExact } from './utils'\n\nexport default class View extends Element {\n\n  constructor(options, children) {\n    super(options, children)\n    this.type = 'view'\n  }\n\n  _getDefaultStyles() {\n    return {\n      ...STYLES.DEFAULT_STYLES,\n      display: STYLES.DISPLAY.BLOCK\n    }\n  }\n\n  _paint() {\n    this.getRender()._drawBackground(this)\n    this.getRender()._drawBox(this)\n  }\n\n\n}\n","import Element from './element'\nimport STYLES from './constants'\nimport { isExact, isAuto } from './utils'\n\nexport default class Text extends Element {\n  constructor(options, children) {\n    super(options, children)\n    this._layout = null // layout用来保存计算的自身高度\n    this._lines = []\n    this.children += ''\n    this.type = 'text'\n  }\n\n  _paint() {\n    this.getRender()._drawBackground(this)\n    this.getRender()._drawText(this)\n    this.getRender()._drawBox(this)\n  }\n\n  _getDefaultStyles() {\n    return {\n      ...STYLES.DEFAULT_STYLES,\n      display: STYLES.DISPLAY.INLINE_BLOCK,\n      width: STYLES.WIDTH.AUTO,\n      textAlign: 'left',\n    }\n  }\n\n  _measureLayout() {\n    this._layout = this.getRender().measureText(this, this.children)\n    this._layout.fontHeight = this.renderStyles.fontSize * 0.8\n    this._layout.height = this.renderStyles.lineHeight\n    this._calcLine()\n    return this._layout\n  }\n\n  _getFont() {\n    const { fontSize, fontWeight, fontFamily } = this.renderStyles\n    return `${fontWeight} ${fontSize}px ${fontFamily}`\n  }\n\n  _calcLine() {\n    if (!this.parent || !this.children) return\n    const { width: textWidth, height: textHeight } = this._layout\n    let { contentWidth: parentContentWidth } = this.parent.renderStyles\n    const { width: parentWidth } = this.parent.styles\n    if (!isAuto(this.styles.width)) parentContentWidth = this.renderStyles.width\n    // 如果一行宽度够，或者父级宽度是auto\n    if ((isExact(parentContentWidth) && parentContentWidth >= textWidth) || parentWidth === STYLES.WIDTH.AUTO) {\n      this._lines = [{\n        text: this.children,\n        layout: this._layout\n      }]\n    } else {\n      this._lines = []\n      let lineIndex = 1\n      let lineText = ''\n      let _layout = null\n      let lastLayout = null\n      for (let i = 0; i < this.children.length; i++) {\n        _layout = this.getRender().measureText(this, lineText + this.children[i])\n        if (_layout.width > parentContentWidth) {\n          if (lineIndex >= this.renderStyles.maxLine) {\n            // 最大行数限制 以及maxline省略号实现\n            lineText = lineText.substring(0, lineText.length - 2) + '...'\n            break\n          }\n          // 超出了\n          this._lines.push({\n            text: lineText,\n            layout: lastLayout || _layout\n          })\n          lineText = ''\n          lineIndex += 1\n\n        }\n\n        lineText += this.children[i]\n\n        lastLayout = _layout\n      }\n      this._layout.width = parentContentWidth\n      this._lines.push({\n        text: lineText,\n        layout: this.getRender().measureText(this, lineText)\n      })\n      // 根据lineheihgt更新height\n      this._layout.height = this._lines.length * this.renderStyles.lineHeight\n    }\n  }\n\n  getInnerText() {\n    return this.children\n  }\n\n  setInnerText(val) {\n    if (val === undefined) return\n    if (val === this.children) return\n    this.children = val\n    this.getLayer().reflowElement(this)\n  }\n}\n","import View from './view'\nimport STYLES from './constants'\nimport { isExact, isAuto, isWX } from './utils'\nimport { getImage } from './weapp-adapter'\n\nexport default class $Image extends View {\n\n  constructor(options, children) {\n    super(options, children)\n    this.type = 'image'\n    this._imageInfo = {\n      width: 0,\n      height: 0,\n      sx: 0,\n      sy: 0,\n      swidth: 0,\n      sheight: 0,\n      dx: 0,\n      dy: 0,\n      dwidth: 0,\n      dheight: 0\n    }\n    this.debugColor = 'blue'\n    this._image = null\n    this._layout = null\n  }\n\n  init() {\n    super.init()\n    this._loadImage()\n  }\n\n  _paint() {\n    this.getRender()._drawBackground(this)\n    this.getRender()._drawImage(this)\n    this.getRender()._drawBox(this)\n  }\n\n  _loadImage() {\n    const { mode } = this.options.attrs\n\n    return new Promise((resolve, reject) => {\n      this.getRender().getImageInstance(this.options.attrs.src)\n        .then(({ info, image }) => {\n          this._imageInfo = info\n          this._image = image\n          resolve()\n\n          this._layoutImage()\n\n          if (this.isVisible()) {\n            // if (mode === 'aspectFill' || mode === 'aspectFit') {\n            //   // this.getLayer().onElementChange(this)\n            //   this.getLayer().repaint(this)\n            // } else {\n            // // 重新布局绘制\n              this.getLayer().reflowElement(this)\n            // }\n          }\n\n          // call load callback\n          if (this.options.on && this.options.on.load) {\n            this.options.on.load(this)\n          }\n        })\n        .catch(err => {\n          // call error callback\n          if (this.options.on && this.options.on.error) {\n            this.options.on.error(err)\n          }\n        })\n    })\n  }\n\n  // 计算图片布局\n  _layoutImage() {\n    const { contentWidth, contentHeight } = this.renderStyles\n    const { mode } = this.options.attrs\n    const { width, height } = this.styles\n    const { width: imageW, height: imageH } = this._imageInfo\n    // 根据用户设置判断图片宽高，目前支持widthfix、heightfix、平铺\n    let w = contentWidth\n    let h = contentHeight\n    if (!isAuto(width) && isAuto(height)) {\n      // width fix\n      w = contentWidth\n      h = getHeightByWidth(w, imageW, imageH)\n    } else if (!isAuto(height) && isAuto(width)) {\n      // height fix\n      h = contentHeight\n      w = getWidthByHeight(h, imageW, imageH)\n    } else if (isAuto(width) && isAuto(height)) {\n      // auto\n      w = imageW\n      h = imageH\n    } else if (mode === 'aspectFill') {\n      // 填充\n      if ((w / h) > (imageW / imageH)) {\n        this._imageInfo.swidth = imageW\n        this._imageInfo.sheight = getHeightByWidth(imageW, w, h)\n        this._imageInfo.sx = 0\n        this._imageInfo.sy = (imageH - this._imageInfo.sheight) / 2\n      } else {\n        this._imageInfo.sheight = imageH\n        this._imageInfo.swidth = getWidthByHeight(imageH, contentWidth, contentHeight)\n        this._imageInfo.sy = 0\n        this._imageInfo.sx = (imageW - this._imageInfo.swidth) / 2\n      }\n    } else if (mode === 'aspectFit') {\n      if ((w / h) > (imageW / imageH)) {\n        this._imageInfo.dwidth = getWidthByHeight(contentHeight, imageW, imageH)\n        this._imageInfo.dheight = contentHeight\n        this._imageInfo.dy = this.contentY\n        this._imageInfo.dx = (contentWidth - this._imageInfo.dwidth) / 2 + this.contentX\n      } else {\n        this._imageInfo.dheight = getHeightByWidth(contentWidth, imageW, imageH)\n        this._imageInfo.dwidth = contentWidth\n        this._imageInfo.dx = this.contentX\n        this._imageInfo.dy = (contentHeight - this._imageInfo.dheight) / 2 + this.contentY\n      }\n    } else {\n      w = contentWidth\n      h = contentHeight\n    }\n    this._layout = { width: w, height: h }\n  }\n\n  _measureLayout() {\n    if (this._layout) {\n      return this._layout\n    } else {\n      return {\n        width: this.renderStyles.width,\n        height: this.renderStyles.height\n      }\n    }\n  }\n\n}\n\n\nfunction getWidthByHeight(height, originWidth, originHeight) {\n  return height / originHeight * originWidth\n}\n\nfunction getHeightByWidth(width, originWidth, originHeight) {\n  return width / originWidth * originHeight\n}\n","import TreeNode from './tree-node'\nimport { walkParent, walk } from './utils'\nconst events = ['click','touchstart','touchmove','touchend','mousewheel']\nexport default class EventManager {\n\n  constructor({ simulateClick = true }) {\n    this.EVENTS = events\n    this.clear()\n    this.touchStartEvent = null\n    this.simulateClick = simulateClick // 是否模拟移动端点击事件\n  }\n\n  clear() {\n    events.forEach(eventName => {\n      this[`${eventName}Tree`] = new TreeNode()\n      this[`${eventName}List`] = []\n    })\n  }\n\n  click(x, y) {\n    let event = new Event({ x, y, type: 'click' })\n    this._emit(event)\n  }\n\n  touchstart(x, y) {\n    let event = new Event({ x, y, type: 'touchstart' })\n    this.touchStartEvent = event\n    this._emit(event)\n  }\n\n  touchmove(x, y) {\n    let event = new Event({ x, y, type: 'touchmove' })\n    this._emit(event)\n  }\n\n  touchend(x, y) {\n    let event = new Event({ x, y, type: 'touchend' })\n    this._emit(event)\n    this.checkClick(event)\n  }\n\n  mousewheel(x,y,deltaX,deltaY){\n    let event = new Event({ x, y,deltaX,deltaY, type: 'mousewheel' })\n    this._emit(event)\n  }\n\n  _emit(e) {\n    let tree = this[`${e.type}Tree`]\n    if(!tree) return\n\n    /**\n     * 遍历树，检查是否回调\n     * 如果父级没有被触发，则子级也不需要检查，跳到下个同级节点\n     * 执行capture回调，将on回调添加到stack\n     */\n    let callbackList = []\n    let curArr = tree._getChildren()\n    while (curArr.length) {\n      walkArray(curArr, (node, callBreak, isEnd) => {\n        if (node.element.isVisible() && this.isPointInElement(e.relativeX, e.relativeY, node.element)) {\n          node.runCapture(e)\n          callbackList.unshift(node)\n          // 同级后面节点不需要执行了\n          callBreak()\n          curArr = node._getChildren()\n        } else if (isEnd) {\n          // 到最后一个还是没监测到，结束\n          curArr = []\n        }\n      })\n    }\n\n    /**\n     * 执行on回调，从子到父\n     */\n    for (let i = 0; i < callbackList.length; i++) {\n      if (!e.currentTarget) e.currentTarget = callbackList[i].element\n      callbackList[i].runCallback(e)\n      if (e.cancelBubble) break\n    }\n  }\n\n  // 待优化\n  isPointInElement(x, y, element) {\n    let a1 = x >= element.x\n    let a2 = y >= element.y\n    let a3 = (x <= (element.x + element.renderStyles.width))\n    let a4 = (y <= (element.y + element.renderStyles.height))\n    if (a1 && a2 && a3 && a4) {\n      return true\n    }\n    return false\n  }\n\n\n  removeElement(element) {\n    events.forEach(eventName => {\n      this[`${eventName}List`] = this[`${eventName}List`].filter(item => {\n        if (item.element === element) {\n          item.remove()\n        }\n        return item.element !== element\n      })\n    })\n  }\n\n  addEventListener(type,callback,element,isCapture){\n    const tree = this[`${type}Tree`]\n    const list = this[`${type}List`]\n    if(!tree){\n      console.error('Unknown event name [' + type+']')\n    }\n    this.addCallback(callback,element,tree,list,isCapture)\n  }\n\n  /**\n   * 不在文档流中，提到relativeTo同级\n   * 根据element树的层级关系构建一个监听回调树模型，提高性能\n   * 有新的监听时，查找应该挂载在哪个节点\n   * 如果节点已经存在，复用原节点\n   * @param {Function} callback\n   * @param {Element} element\n   * @param {Callback} tree\n   * @param {Array<Callback>} list\n   * @param {Boolean} isCapture\n   */\n  addCallback(callback, element, tree, list, isCapture) {\n    let parent = null\n    let node = null\n    // 寻找应该挂载的父节点\n    let target = element\n    for (let i = list.length - 1; i >= 0; i--) {\n      // 寻找已存在节点\n      if (element === list[i].element) {\n        // 当前\n        parent = list[i - 1]\n        node = list[i]\n        break\n      }\n      // 寻找应该挂载的父节点 通过对比当前父级最近的父级\n      if (!element.isInFlow()) {\n        target = element.relativeTo.parent\n        if (!target) {\n          break\n        }\n      }\n      walkParent(target, (p, callBreak) => {\n        if (p === list[i].element) {\n          parent = list[i]\n          callBreak()\n        }\n      })\n      if (parent) {\n        break\n      }\n    }\n\n    // 如果不存在同样的元素节点\n    if (!node) {\n      node = new Callback(element, callback)\n    }\n\n    // 添加回调方法\n    if (isCapture) {\n      node.addCapture(callback)\n    } else {\n      node.addCallback(callback)\n    }\n\n    // 挂载节点\n    if (parent) {\n      // 用prepend是因为后来的层级上高于前面的，但是只有在absolute的元素才能感受到\n      parent.prependChild(node)\n    } else {\n      tree.prependChild(node)\n    }\n\n    // 缓存到list\n    list.push(node)\n  }\n\n  // 这里利用touchstart和touchend实现了移动端click事件\n  checkClick(event) {\n    if (this.touchStartEvent && this.simulateClick) {\n      // 判断两点距离\n      let { x: startx, y: starty } = this.touchStartEvent\n      let { x: endx, y: endy } = event\n      let distance = ((endy * endy + endx * endx) - (starty * starty + startx * startx))\n      if (distance < 5 && distance > -5) {\n        this.click(endx, endy)\n      }\n    }\n  }\n}\n\nclass Event {\n  constructor({ x, y, type,deltaX,deltaY }) {\n    this.x = x\n    this.y = y\n    this.relativeX = x // scroll到每一层scrollview会不断变化\n    this.relativeY = y\n    this.type = type\n    this.cancelBubble = false\n    this.currentTarget = null // 第一个element\n\n    if(type === 'mousewheel'){\n      this.deltaX = deltaX\n      this.deltaY = deltaY\n    }\n  }\n\n  // 阻止冒泡\n  stopPropagation() {\n    this.cancelBubble = true\n  }\n}\n\nclass Callback extends TreeNode {\n  constructor(element) {\n    super()\n    this.element = element\n    this.callbackList = []\n    this.captureList = []\n  }\n\n  addCallback(callback) {\n    this.callbackList.push(callback)\n  }\n\n  addCapture(callback) {\n    this.captureList.push(callback)\n  }\n\n  runCallback(params) {\n    this.callbackList.forEach(item => item.call(this.element,params))\n  }\n\n  runCapture(params) {\n    this.captureList.forEach(item => item.call(this.element,params))\n  }\n\n}\n\n\nfunction walkArray(arr, callback) {\n  let _break = false\n  const callBreak = () => _break = true\n  for (let i = 0; i < arr.length; i++) {\n    callback(arr[i], callBreak, i === arr.length - 1 ? true : false)\n    if (_break) {\n      break\n    }\n  }\n}\n","import { isExact, walk, isOuter, parseOuter, walkParent, isEndNode, isAuto, isWX, qSort3, getThrottle, floor } from './utils'\nimport TreeNode from './tree-node'\nimport STYLES from './constants'\nimport { getImage } from './weapp-adapter'\n\nconst angle = Math.PI / 2\n\n/**\n * 封装图形api\n */\nexport default class CanvasRender {\n  constructor(layer) {\n    this.layer = layer\n    this.imageBus = {}\n    this.isAnimate = false\n    this.lastPaintTime = 0\n    this.lastFrameComplete = false\n    this.throttle = getThrottle(16)\n  }\n\n  getCtx() {\n    return this.layer.ctx\n  }\n\n  getLayer() {\n    return this.layer\n  }\n\n  _restore(callback) {\n    this.getCtx().save()\n    callback()\n    this.getCtx().restore()\n  }\n\n  _path(callback) {\n    this.getCtx().beginPath()\n    callback()\n    this.getCtx().closePath()\n  }\n\n  paint(element) {\n    this.getCtx().save()\n\n    element._paint(this.lastPaintTime)\n\n    this.afterPaint(element)\n  }\n\n  afterPaint(element) {\n    // 这里通过this.ctx栈实现了overflow\n    // 第一步判断没有子元素，绘制完成即restore 有子元素需要子元素全部绘制完毕再restore\n    if (!element.hasChildren() || element.type === 'text') {\n      this.getCtx().restore()\n    }\n\n    // 如果到了层级的最后一个 释放父级的stack\n    this._helpParentRestoreCtx(element)\n  }\n\n  _helpParentRestoreCtx(element) {\n    if ((element.isVisible() && !isEndNode(element)) || (!element.isVisible() && element.next)) return\n    this.getCtx().restore()\n    let cur = element.parent\n    while (cur && !cur.next) {\n      // 如果父级也是同级最后一个，再闭合上一个\n      this.getCtx().restore()\n      cur = cur.parent\n    }\n\n\n  }\n\n  topBorder({ x, y, borderRadius, w, h }) {\n    // 左上角开始\n    this.getCtx().moveTo(x, y + borderRadius)\n    borderRadius && this.getCtx().arc(x + borderRadius, y + borderRadius, borderRadius, 2 * angle, 3 * angle)\n    this.getCtx().lineTo(x + w - borderRadius, y)\n  }\n\n  rightBorder({ x, y, borderRadius, w, h }) {\n    // 右上角\n    // this.getCtx().moveTo(x + w - borderRadius, y)\n    borderRadius && this.getCtx().arc(x + w - borderRadius, y + borderRadius, borderRadius, 3 * angle, 4 * angle)\n    this.getCtx().lineTo(x + w, y + h - borderRadius)\n  }\n\n  bottomBorder({ x, y, borderRadius, w, h }) {\n    // 右下角\n    // this.getCtx().moveTo(x + w, y + h - borderRadius)\n    borderRadius && this.getCtx().arc(x + w - borderRadius, y + h - borderRadius, borderRadius, 0, angle)\n    this.getCtx().lineTo(x + borderRadius, y + h)\n  }\n\n  leftBorder({ x, y, borderRadius, w, h }) {\n    // 左下角\n    borderRadius && this.getCtx().arc(x + borderRadius, y + h - borderRadius, borderRadius, angle, angle * 2)\n    this.getCtx().lineTo(x, y + borderRadius)\n  }\n\n  _drawBox(element) {\n    if (!(element.renderStyles.borderColor || element.renderStyles.shadowBlur)) return\n    const { contentWidth, contentHeight, paddingLeft, paddingTop, borderStyle,\n      paddingRight, paddingBottom, shadowBlur, shadowColor, backgroundColor, shadowOffsetX, shadowOffsetY,\n      borderLeftWidth, borderRightWidth, borderTopWidth, borderBottomWidth, borderWidth } = element.renderStyles\n\n    let borderRadius = getBorderRadius(element)\n\n\n    // 这里是计算画border的位置，起点位置是在线条中间，所以要考虑线条宽度\n    let x = element.contentX - element.renderStyles.paddingLeft - borderLeftWidth / 2\n    let y = element.contentY - element.renderStyles.paddingTop - borderTopWidth / 2\n    let w = contentWidth + paddingLeft + paddingRight + (borderLeftWidth + borderRightWidth) / 2\n    let h = contentHeight + paddingTop + paddingBottom + (borderTopWidth + borderBottomWidth) / 2\n\n    this.getCtx().lineCap = element.renderStyles.lineCap\n    this.getCtx().strokeStyle = element.renderStyles.borderColor\n    this.getCtx().lineJoin = 'round'\n\n    // 实现虚线\n    if (borderStyle && borderStyle !== 'solid') {\n      if (Array.isArray(borderStyle)) {\n        this.getCtx().setLineDash(borderStyle)\n      } else {\n        this.getCtx().setLineDash([5, 5])\n      }\n    }\n\n    const stroke = (borderWidth) => {\n      // 有样式则绘制出来\n      this.getCtx().lineWidth = borderWidth\n      this.getCtx().stroke()\n    }\n    this._restore(() => {\n      this._path(() => {\n\n        if (element.renderStyles.borderTopWidth) {\n          this.topBorder({ x, y, borderRadius: borderRadius ? borderRadius + (element.renderStyles.borderTopWidth / 2) : 0, w, h })\n          // 判断borderwidth 如果都是一样宽，只需要最后一次性绘制，提高性能\n          !borderWidth && stroke(element.renderStyles.borderTopWidth)\n        }\n        if (element.renderStyles.borderRightWidth) {\n          this.getCtx().moveTo(x + w - borderRadius - (borderRadius ? (element.renderStyles.borderTopWidth / 2) : 0), y)\n          this.rightBorder({ x, y, borderRadius: borderRadius ? borderRadius + element.renderStyles.borderRightWidth / 2 : 0, w, h })\n          !borderWidth && stroke(element.renderStyles.borderRightWidth)\n        }\n        if (element.renderStyles.borderBottomWidth) {\n          this.getCtx().moveTo(x + w, y + h - borderRadius - (borderRadius ? (element.renderStyles.borderRightWidth / 2) : 0))\n          this.bottomBorder({ x, y, borderRadius: borderRadius ? borderRadius + (element.renderStyles.borderBottomWidth / 2) : 0, w, h })\n          !borderWidth && stroke(element.renderStyles.borderBottomWidth)\n        }\n        if (element.renderStyles.borderLeftWidth) {\n          this.getCtx().moveTo(x + borderRadius + (borderRadius ? (element.renderStyles.borderBottomWidth / 2) : 0), y + h)\n          this.leftBorder({ x, y, borderRadius: borderRadius ? borderRadius + (element.renderStyles.borderLeftWidth / 2) : 0, w, h })\n          stroke(element.renderStyles.borderLeftWidth)\n        }\n      })\n    })\n\n  }\n\n  _drawBackground(element) {\n    const { backgroundColor, contentWidth, contentHeight, shadowColor, shadowBlur,\n      paddingLeft, paddingRight, paddingTop, paddingBottom, opacity, shadowOffsetX, shadowOffsetY,\n      borderLeftWidth, borderRightWidth, borderTopWidth, borderBottomWidth } = element.renderStyles\n    const ctx = this.getCtx()\n\n    let borderRadius = getBorderRadius(element)\n\n\n    // 这里是计算画border的位置，起点位置是在线条中间，所以要考虑线条宽度\n    let x = element.contentX - element.renderStyles.paddingLeft - borderLeftWidth\n    let y = element.contentY - element.renderStyles.paddingTop - borderTopWidth\n    let w = contentWidth + paddingLeft + paddingRight + (borderLeftWidth + borderRightWidth)\n    let h = contentHeight + paddingTop + paddingBottom + (borderTopWidth + borderBottomWidth)\n\n    if (isExact(opacity)) {\n      // 绘制透明图\n      ctx.globalAlpha = opacity\n    }\n\n    // 绘制boxshadow\n    // 需要在clip之前\n    if (shadowColor && shadowBlur) {\n      this._restore(() => {\n        this._path(() => {\n          this.topBorder({ x, y, borderRadius, w, h })\n          this.rightBorder({ x, y, borderRadius, w, h })\n          this.bottomBorder({ x, y, borderRadius, w, h })\n          this.leftBorder({ x, y, borderRadius, w, h })\n        })\n        if (isExact(shadowOffsetX)) {\n          this.getCtx().shadowOffsetX = shadowOffsetX\n        }\n        if (isExact(shadowOffsetY)) {\n          this.getCtx().shadowOffsetY = shadowOffsetY\n        }\n        this.getCtx().shadowBlur = shadowBlur\n        this.getCtx().shadowColor = shadowColor\n        this.getCtx().fillStyle = shadowColor\n        this.getCtx().fill()\n      })\n    }\n\n    this._clip(element)\n\n\n\n    // draw background\n    if (backgroundColor) {\n      this.getCtx().fillStyle = this._parseBackground(backgroundColor, element)\n      this.getCtx().fillRect(element.contentX - paddingLeft, element.contentY - paddingTop, contentWidth + paddingLeft + paddingRight, contentHeight + paddingTop + paddingBottom)\n    }\n\n    // for debug\n    if (this.getLayer().options && this.getLayer().options.debug) {\n      this.getCtx().strokeStyle = 'green'\n      this.getCtx().strokeRect(element.contentX, element.contentY, element.renderStyles.contentWidth, element.renderStyles.contentHeight)\n      // ctx.strokeStyle = '#fff'\n      // ctx.strokeText(`${parseInt(this.contentX)} ${parseInt(this.contentY)} ${contentWidth} ${contentHeight}`, this.contentX + 100, this.contentY + 10)\n\n      //\n    }\n  }\n\n  _clip(element) {\n    if (element.renderStyles.overflow !== 'hidden') return\n    const { contentWidth, contentHeight, paddingLeft, paddingTop,\n      paddingRight, paddingBottom, shadowBlur, shadowColor, backgroundColor,\n      borderLeftWidth, borderRightWidth, borderTopWidth, borderBottomWidth } = element.renderStyles\n\n    const angle = Math.PI / 2\n\n    let borderRadius = getBorderRadius(element)\n\n    // 为了把border也切进去\n    let x = element.contentX - element.renderStyles.paddingLeft - borderLeftWidth\n    let y = element.contentY - element.renderStyles.paddingTop - borderTopWidth\n    let w = contentWidth + paddingLeft + paddingRight + borderLeftWidth + borderRightWidth\n    let h = contentHeight + paddingTop + paddingBottom + borderTopWidth + borderBottomWidth\n\n    this._path(() => {\n      this.topBorder({ x, y, borderRadius, w, h })\n      this.rightBorder({ x, y, borderRadius, w, h })\n      this.bottomBorder({ x, y, borderRadius, w, h })\n      this.leftBorder({ x, y, borderRadius, w, h })\n    })\n\n\n    this.getCtx().clip()\n\n  }\n\n  _parseBackground(color, element) {\n    if (Array.isArray(color)) {\n      const gradient = this.getCtx().createLinearGradient(element.contentX, element.contentY, element.renderStyles.contentWidth, element.renderStyles.contentHeight)\n      for (let i = 0; i < color.length; i++) {\n        if (i === 0) {\n          gradient.addColorStop(0, color[0])\n        } else {\n          gradient.addColorStop(i / (color.length - 1), color[i])\n        }\n      }\n      return gradient\n    } else {\n      return color\n    }\n  }\n\n\n  _drawText(element) {\n    const { color, contentWidth, lineHeight, textAlign, textIndent, textDecoration } = element.renderStyles\n    let x = element.contentX\n    this.getCtx().fillStyle = color\n    this.getCtx().textAlign = textAlign\n    this.getCtx().font = element._getFont()\n    this.getCtx().textBaseline = 'top'\n    if (textAlign === STYLES.TEXT_ALIGN.RIGHT) {\n      x = element.contentX + contentWidth\n    } else if (textAlign === STYLES.TEXT_ALIGN.CENTER) {\n      x = element.contentX + (contentWidth / 2)\n    }\n    let _x = x\n    let _y = 0\n    element._lines.forEach((line, index) => {\n      if (index === 0 && textIndent) {\n        // 第一行实现textIndent\n        _x = x + textIndent\n      } else {\n        _x = x\n      }\n      _y = (element.contentY + (lineHeight - element._layout.fontHeight) / 2 + lineHeight * index) - 1\n      this.getCtx().fillText(line.text, _x, _y)\n      if (isWX() && element.renderStyles.fontWeight !== 400) {\n        // 小程序 字体加粗不生效\n        const offset = element.renderStyles.fontSize * 0.001\n        this.getCtx().fillText(line.text, _x - offset, _y)\n      }\n      // draw decoration\n      if (textDecoration) {\n        const decorationType = textDecoration[0]\n        _y += 1\n        this._restore(() => {\n          this._path(() => {\n            let decorationY = _y\n            if (decorationType === 'underline') {\n              decorationY = _y + lineHeight - (lineHeight - element._layout.fontHeight) / 2\n            } else if (decorationType === 'line-through') {\n              decorationY = _y + element._layout.fontHeight / 2\n            }\n            this.getCtx().moveTo(_x, decorationY)\n            this.getCtx().lineTo(_x + line.layout.width, decorationY)\n          })\n          this.getCtx().strokeStyle = color\n          this.getCtx().stroke()\n        })\n      }\n    })\n  }\n\n  /**\n   * @param {String} text\n   * @return {Object<width,height>}\n   */\n  measureText(element, text) {\n    let w = 0\n    this._restore(() => {\n      this.getCtx().font = element._getFont()\n      const { width } = this.getCtx().measureText(text)\n      w = width\n    })\n    return {\n      width: w\n    }\n  }\n\n  _drawImage(element) {\n    if (!element._image) return\n    const { contentWidth, contentHeight } = element.renderStyles\n    const { mode } = element.options.attrs\n    const { sx, sy, swidth, sheight, dx, dy, dwidth, dheight, width: imageW, height: imageH } = element._imageInfo\n    if (mode === 'aspectFill') {\n      this.getCtx().drawImage(element._image, sx, sy, swidth, sheight, element.contentX, element.contentY, contentWidth, contentHeight)\n    } else if (mode === 'aspectFit') {\n      this.getCtx().drawImage(element._image, 0, 0, imageW, imageH, dx, dy, dwidth, dheight)\n    } else {\n      this.getCtx().drawImage(element._image, element.contentX, element.contentY, contentWidth, contentHeight)\n    }\n  }\n\n  _drawScroll(element) {\n    this.getCtx().translate(element.currentScrollX, element.currentScrollY)\n  }\n\n  /**\n   * 这里应该保证onload src等接口\n   */\n  getImageInstance(src) {\n    let image = null\n\n    // 同样的路径返回缓存\n    if (this.imageBus[src]) {\n      image = this.imageBus[src]\n    } else {\n\n      if (isWX()) {\n        if (this.getCanvas()) {\n          image = this.getCanvas().createImage()\n        } else {\n          console.warn('小程序请使用设置canvas参数以创建图片')\n          image = getImage(src)\n        }\n      } else {\n        image = new Image()\n      }\n\n      if (src) {\n        this.imageBus[src] = new Promise((resolve, reject) => {\n          image.onload = (e) => {\n            resolve({\n              image: isWX() && !this.getCanvas() ? e.image : image,\n              info: {\n                width: isWX() ? image.width : e.target.width,\n                height: isWX() ? image.height : e.target.height\n              }\n            })\n          }\n        })\n      }\n\n      image.src = src\n    }\n    return this.imageBus[src]\n  }\n\n  render(node) {\n    this.lastFrameComplete = false\n    this.lastPaintTime = Date.now()\n    if (!node.parent) {\n      // root\n      this.getCtx().clearRect(0, 0, this.getLayer().options.width, this.getLayer().options.height)\n    } else {\n      this.getCtx().clearRect(node.x, node.y, node.renderStyles.width, node.renderStyles.height)\n    }\n    let element = null\n    walk(node, (renderNode, callContinue, callNext) => {\n      if (renderNode.isVisible()) {\n        // 可见的才渲染\n        this.paint(renderNode)\n      } else {\n        // 跳过整个子节点\n        callNext()\n        this._helpParentRestoreCtx(renderNode)\n      }\n    })\n    if (isWX()) {\n      // 兼容小程序\n      this.getCtx().draw && this.getCtx().draw()\n    }\n\n    this.lastFrameComplete = true\n\n  }\n\n  renderFPS() {\n\n  }\n\n  readyToRender(element) {\n\n    // this.element = generateRenderTree(element)\n    this.element = element\n\n    const options = this.getLayer().options\n\n    this.lastPaintTime = Date.now()\n\n    if (options && options.animate) {\n      this.animate()\n    } else {\n      this.render(this.element)\n    }\n\n  }\n\n  requestRepaint(element) {\n    if (this.isAnimate) return\n    // 如果已经有frame在排队等待了 忽略\n    // if(!this.lastFrameComplete) return\n    // let nextFrameTime = Date.now() - this.lastPaintTime\n    // if(nextFrameTime < 16){\n    //   setTimeout(() => this.render(this.element),nextFrameTime)\n    // }else{\n    this.render(this.element)\n    // }\n\n  }\n\n  // could be null\n  getCanvas() {\n    const options = this.getLayer().options\n    return options && options.canvas || null\n  }\n\n  _animate(preTime) {\n    const now = Date.now()\n    this.render(this.element)\n    if (!this.isAnimate) return\n    window.requestAnimationFrame(() => this._animate(now))\n  }\n\n  /**\n   * 不建议使用了\n   */\n  animate() {\n    this.isAnimate = true\n    window.requestAnimationFrame(() => this._animate())\n  }\n\n  stopAnimate() {\n    this.isAnimate = false\n  }\n\n  // 所有副作用完成\n  // 图片加载异步请求\n  onEffectFinished() {\n    const list = Object.keys(this.imageBus).map(key => {\n      return this.imageBus[key]\n    })\n    return Promise.all(list)\n  }\n\n\n\n}\n\nfunction getBorderRadius(element) {\n  const { paddingWidth, paddingHeight } = element.renderStyles\n  let { borderRadius } = element.renderStyles\n  if (borderRadius * 2 > paddingWidth) {\n    // 如果大于一半，则角不是90度，统一限制最大为一半\n    borderRadius = paddingWidth / 2\n  }\n  if (borderRadius * 2 > paddingHeight) {\n    borderRadius = paddingHeight / 2\n  }\n  if (borderRadius < 0) borderRadius = 0\n  return floor(borderRadius)\n}\n\n// function generateRenderTree(element){\n//   const _root = new RenderNode(element)\n//   let preZ = 0\n//   let pivotZ = 0\n//   let cur = null\n//   let stack = [_root]\n//   while(stack.length){\n//     cur = stack.pop()\n//     if(cur.element.hasChildren()){\n//       cur.children = cur.element._getChildren().map(item => new RenderNode(item))\n//       // sort by zIndex\n//       cur.children = qSort3(cur.children,(pre,pivot) => {\n//         preZ = pre.element.renderStyles.zIndex || 0\n//         pivotZ = pivot.element.renderStyles.zIndex || 0\n//         return preZ - pivotZ\n//       })\n//       Array.prototype.push.apply(stack,cur.children)\n//     }\n//   }\n//   TreeNode.connectChildren(_root)\n//   return _root\n// }\n\n// class RenderNode extends TreeNode {\n//   constructor(element){\n//     super()\n//     this.element = element\n//   }\n// }\n","import { isWX } from \"./utils\"\n\n// 只支持小程序最新的支持同层渲染的canvas api,\n// 不用了\nexport function getImage(url) {\n  const instance = {onload: () => {}}\n  new Promise((resolve, reject) => {\n    wx.downloadFile({\n      url:url,\n      success(res) {\n        wx.getImageInfo({\n          src: res.tempFilePath,\n          success(res1) {\n            resolve({\n              target: {\n                width: res1.width,\n                height: res1.height\n              },\n              image: res.tempFilePath\n            })\n          }\n        })\n      },\n      fail(err) {\n        reject(err)\n      }\n    })\n  })\n  .then((res) => {\n    instance.onload(res)\n  })\n  .catch(err => {\n\n  })\n  return instance\n}\n\n","import EventManager from './event-manager'\nimport { walk, breadthFirstSearch, breadthFirstSearchRight, walkParent, isWX } from './utils'\nimport TreeNode from './tree-node'\nimport CanvasRender from './canvas-render'\nexport default class Layer {\n  constructor(ctx, options) {\n    this.ctx = ctx\n    this.node = null\n    this.isAnimate = false\n    this.nodeList = []\n    this.p2cList = []\n    this.c2pList = []\n    this.renderList = []\n    this.options = options\n    this.eventManager = new EventManager(options)\n    this.render = new CanvasRender(this)\n  }\n\n  update(ctx, options) {\n    this.ctx = ctx\n    this.options = options\n    this.options.renderStyles = options\n    this.node.container = this.options\n  }\n\n  mountNode(node) {\n    this.node = node\n    this.node.root = this.node\n    this.node.layer = this\n    this.node.container = this.options\n    // 事件也清空一下，重新挂载\n    this.eventManager.clear()\n    this.initRender()\n  }\n\n  initRender() {\n    // for 打印耗时\n    const startTime = Date.now()\n\n    TreeNode.connectChildren(this.node)\n    this.initP2CList()\n    this.initC2PList()\n\n    this.flow()\n\n    // flow 完成后监听effect完成\n    this.render.onEffectFinished()\n      .then((res) => this.lifecycle('onEffectSuccess', res))\n      .catch((res) => this.lifecycle('onEffectFail', res))\n    // .finally((res) => this.lifecycle('onEffectFinished', res))\n\n    this.repaint()\n\n    console.log(`渲染${this.p2cList.length}个元素 耗时 ${(Date.now() - startTime)} ms`)\n  }\n\n  initP2CList() {\n    // 广度优先\n    this.p2cList = breadthFirstSearch(this.node)\n  }\n\n  initC2PList() {\n    this.c2pList = breadthFirstSearchRight(this.node)\n  }\n\n\n  flow(node = this.node) {\n    for (let i = 0; i < this.p2cList.length; i++) {\n      this.p2cList[i].init()\n    }\n\n    this.reflow()\n  }\n\n  initPaintList() {\n    // 这里实现index\n    this.renderList = this.nodeList\n  }\n\n  reflow(node = this.node) {\n\n    for (let i = 0; i < this.c2pList.length; i++) {\n      this.c2pList[i]._initWidthHeight()\n    }\n\n    for (let i = 0; i < this.p2cList.length; i++) {\n      this.p2cList[i]._initPosition()\n    }\n  }\n\n  reflowElement(element) {\n    // 如果有line，则需要重第一个开始\n    let target = element\n    while (target && target.line) {\n      target = target.parent\n    }\n    const p2cList = breadthFirstSearch(target)\n    for (let i = 0; i < p2cList.length; i++) {\n      p2cList[i]._initStyles()\n    }\n\n    // 所有子元素\n    const children = breadthFirstSearchRight(target)\n    for (let i = 0; i < children.length; i++) {\n      children[i]._initWidthHeight()\n    }\n\n    if (!element.isInFlow()) {\n      for (let i = 0; i < p2cList.length; i++) {\n        p2cList[i]._initPosition()\n      }\n      this.repaint()\n    } else {\n      this.onElementChange(target)\n    }\n\n\n  }\n\n  onElementRemove(element) {\n    this.eventManager.removeElement(element)\n    this.initC2PList()\n    this.initP2CList()\n    this.reflowElement(element)\n  }\n\n  onElementAdd(element) {\n    TreeNode.connectChildren(element)\n    this.initC2PList()\n    this.initP2CList()\n    breadthFirstSearch(element).forEach(item => item.init())\n    this.reflowElement(element)\n  }\n\n  // 元素变化后调用，尽可能少重排重绘\n  onElementChange(element) {\n\n    walkParent(element, (parent, callbreak) => {\n      parent._initWidthHeight()\n      if (parent.type === 'scroll-view') callbreak()\n    })\n\n    for (let i = 0; i < this.p2cList.length; i++) {\n      this.p2cList[i]._initPosition()\n    }\n    this.repaint()\n  }\n\n  callBeforePaint() {\n    for (let i = 0; i < this.p2cList.length; i++) {\n      this.p2cList[i].beforePaint && this.p2cList[i].beforePaint()\n    }\n  }\n\n  /**\n   * 可以给定element，则只会重绘element所在的区域\n   * @param {Element} element\n   */\n  repaint(element = this.node) {\n    if (isWX()) {\n      // 微信环境下始终重绘整个树\n      element = this.node\n    }\n    if (!element.isInFlow()) element = this.node\n\n    this.callBeforePaint()\n\n    this.render.readyToRender(this.node)\n  }\n\n  animate() {\n    console.warn('use [animate] option instead!')\n  }\n\n  getElementBy() {\n    return this.node.getElementBy(...arguments)\n  }\n\n  lifecycle(name, arg) {\n    if (this.options.lifecycle) {\n      this.options.lifecycle[name] && this.options.lifecycle[name](arg)\n    }\n  }\n\n}\n\n\n","import View from './view'\nimport { easeInOutElastic, isExact, isAuto, floor } from './utils'\nimport STYLES from './constants'\n\nexport default class ScrollView extends View {\n\n  constructor(options, children) {\n    const { styles, ...rest } = options\n    super(rest, children)\n    this.options.styles = {\n      direction: styles.direction || 'y'\n    }\n    // 外面包裹一层容器，内层的滚动\n    options.styles.overflow = 'hidden'\n    this.type = 'scroll-view'\n    this._scrollView = new View(options, [this])\n    this._scrollView.type = 'scroll-view-container'\n    this.visibleIndex = null\n    this.renderOnDemand = options.attrs && options.attrs.renderOnDemand || false\n    return this._scrollView\n  }\n\n  _getDefaultStyles() {\n    return {\n      ...STYLES.DEFAULT_STYLES,\n      direction: 'y',\n    }\n  }\n\n  beforePaint() {\n    this.initChildrenVisible()\n  }\n\n  _initWidthHeight() {\n    super._initWidthHeight()\n    // 这里需要父级款高度，但是外层必须是exact\n    this.initScroll()\n  }\n\n  _paint() {\n    this.getRender()._drawBackground(this)\n    this.getRender()._drawScroll(this)\n    this.getRender()._drawBox(this)\n  }\n\n  init() {\n    super.init()\n    this.addEventListener()\n    const { height, width } = this._scrollView.styles\n    const { direction } = this.styles\n    if (direction.match('y')) {\n      if (isAuto(height)) {\n        // 必须设置\n        console.error('scroll-view 必须设置明确的高度')\n      } else {\n        this.styles.height = 'auto'\n        this.renderStyles.height = 'auto'\n      }\n    }\n    if (direction.match('x')) {\n      if (isAuto(width)) {\n        // 必须设置\n        console.error('scroll-view 必须设置明确的宽度')\n      } else {\n        this.styles.width = 'auto'\n        this.renderStyles.width = 'auto'\n      }\n    }\n  }\n\n  addEventListener() {\n    // 监听滚动\n    this.currentScrollX = 0\n    this.currentScrollY = 0\n    let direction = this.styles.direction\n    let startX = 0\n    let startY = 0\n    let lastStartX = 0\n    let lastStartY = 0\n    let startMove = false\n    let offsetX = 0\n    let offsetY = 0\n    let speedX = 0\n    let speedY = 0\n    let glideInterval = null\n    let resistanceX = 1\n    let resistanceY = 1\n\n    this.getLayer().eventManager.EVENTS.forEach(eventName => {\n      this.getLayer().eventManager.addEventListener(eventName, (e) => {\n        if (direction.match('y')) {\n          e.relativeY -= this.currentScrollY\n        }\n        if (direction.match('x')) {\n          e.relativeX -= this.currentScrollX\n        }\n      }, this._scrollView, true)\n    })\n\n    this.getLayer().eventManager.addEventListener('mousewheel', (e) => {\n      if (!this.scrollBy(e.deltaX, e.deltaY)) {\n        this.scrollTo({ x: e.deltaX <= 0 ? this.maxScrollX : 0, y: e.deltaY <= 0 ? this.maxScrollY : 0 })\n      } else {\n        e.stopPropagation()\n      }\n    }, this._scrollView)\n\n    this.getLayer().eventManager.addEventListener('touchstart', (e) => {\n      e.stopPropagation()\n      startX = e.x\n      startY = e.y\n      lastStartX = startX\n      lastStartY = startY\n      startMove = true\n      clearInterval(glideInterval)\n    }, this._scrollView)\n    this.getLayer().eventManager.addEventListener('touchmove', (e) => {\n      if (startMove) {\n        e.stopPropagation()\n        offsetX = (e.x - startX)\n        offsetY = (e.y - startY)\n        if (this.scrollBy(offsetX, offsetY)) {\n          lastStartX = startX\n          lastStartY = startY\n          startX = e.x\n          startY = e.y\n        }\n      }\n    }, this._scrollView)\n    this.getLayer().eventManager.addEventListener('touchend', (e) => {\n      if (startMove) {\n        startMove = false\n\n        speedX = (e.x - lastStartX)\n        speedY = (e.y - lastStartY)\n        resistanceX = -speedX * 0.02\n        resistanceY = -speedY * 0.02\n        clearInterval(glideInterval)\n        glideInterval = setInterval(() => {\n          if (!this.scrollBy(speedX, speedY)) {\n            this.scrollTo(this.currentScrollX + speedX, this.currentScrollY + speedY)\n            clearInterval(glideInterval)\n          }\n          speedX += resistanceX\n          speedY += resistanceY\n          if (speedX * speedX <= 0.05 && speedY * speedY <= 0.05) {\n            speedX = 0\n            speedY = 0\n            clearInterval(glideInterval)\n          }\n        }, 16)\n      }\n    }, this._scrollView)\n  }\n\n  initScroll() {\n    const { contentWidth: offsetWidth, contentHeight: offsetHeight } = this._scrollView.renderStyles\n    const { width: scrollWidth, height: scrollHeight, direction } = this.renderStyles\n    this.maxScrollX = scrollWidth - offsetWidth\n    this.maxScrollY = scrollHeight - offsetHeight\n  }\n\n  calcScrollBoundX(offsetX) {\n    if ((- this.currentScrollX - offsetX) > this.maxScrollX) {\n      return false\n    } else if (this.currentScrollX + offsetX > 0) {\n      return false\n    }\n\n    return true\n  }\n\n  calcScrollBoundY(offsetY) {\n    if ((- this.currentScrollY - offsetY) > this.maxScrollY) {\n      return false\n    } else if (this.currentScrollY + offsetY > 0) {\n      return false\n    }\n\n    return true\n  }\n\n  scrollByX(offsetX) {\n    if (!this.renderStyles.direction.match('x')) return false\n    if (this.calcScrollBoundX(offsetX)) {\n      this.currentScrollX += offsetX\n      return true\n    } else {\n      return false\n    }\n  }\n\n  scrollByY(offsetY) {\n    if (!this.renderStyles.direction.match('y')) return false\n    if (this.calcScrollBoundY(offsetY)) {\n      this.currentScrollY += floor(offsetY)\n      this.calcChildrenVisible()\n      // this.getLayer().repaint(this._scrollView)\n      return true\n    } else {\n      return false\n    }\n  }\n\n  scrollBy(offsetX, offsetY) {\n    // 这里要两个都运行，所以不要用短路\n    if (this.scrollByX(offsetX) | this.scrollByY(offsetY)) {\n      this.getRender().requestRepaint(this._scrollView)\n      return true\n    }\n    return false\n  }\n\n  scrollTo({ x, y }) {\n    if (isExact(x) && this.maxScrollX > 0) {\n      x = x\n      if (x > this.maxScrollX) x = this.maxScrollX\n      this.currentScrollX = -floor(x)\n    }\n    if (isExact(y) && this.maxScrollY > 0) {\n      y = y\n      if (y > this.maxScrollY) y = this.maxScrollY\n      this.currentScrollY = -floor(y)\n    }\n    this.initChildrenVisible()\n    this.getRender().requestRepaint(this._scrollView)\n  }\n\n  // TODO:\n  initChildrenVisible() {\n    if (!this.renderOnDemand) return\n\n    // console.log('==============')\n    const children = this._getChildrenInFlow()\n    // 左\n    for (let i = 0; i < children.length; i++) {\n      if (this.isElementInViewport(children[i])) {\n        this.visibleIndex = [i, -1]\n        break\n      } else {\n        children[i].visible = false\n      }\n    }\n\n    // 右\n    for (let i = children.length - 1; i >= 0; i--) {\n      if (this.isElementInViewport(children[i])) {\n        this.visibleIndex[1] = i\n        break\n      } else {\n        children[i].visible = false\n      }\n    }\n\n    // 中间\n    for (let i = this.visibleIndex[0]; i <= this.visibleIndex[1]; i++) {\n      children[i].visible = true\n    }\n  }\n\n  // 只用计算两头\n  // 数据量时能显著提高效率\n  // 滚动太快会有问题，暂时使用上面的init\n  calcChildrenVisible() {\n    if (!this.renderOnDemand) return\n    const children = this._getChildrenInFlow()\n    const head = generateSiblingNodeIndex(this.visibleIndex[0], 5)\n    const foot = generateSiblingNodeIndex(this.visibleIndex[1], 5)\n    let visibleIndex = []\n    for (let i = head[0]; i <= head[head.length - 1]; i++) {\n      if (children[i]) {\n        if (this.isElementInViewport(children[i])) {\n          children[i].visible = true\n          if (!visibleIndex.length) {\n            visibleIndex.push(i)\n          }\n        } else {\n          children[i].visible = false\n        }\n      }\n    }\n    for (let i = foot[foot.length - 1]; i >= foot[0]; i--) {\n      if (children[i]) {\n        if (this.isElementInViewport(children[i])) {\n          children[i].visible = true\n          if (visibleIndex.length === 1) {\n            visibleIndex.push(i)\n          }\n        } else {\n          children[i].visible = false\n        }\n      }\n    }\n    this.visibleIndex = visibleIndex\n    if (this.visibleIndex.length < 2) {\n      this.initChildrenVisible()\n    }\n  }\n\n  isElementInViewport(element) {\n    if (this.styles.direction.match('y')) {\n      return ((element.y + element.renderStyles.height + this.currentScrollY) > this._scrollView.contentY)\n        && ((element.y + this.currentScrollY) < this._scrollView.contentY + this._scrollView.renderStyles.contentHeight)\n    } else {\n      return true\n      // return ((element.x + element.renderStyles.width + this.currentScroll) > this._scrollView.contentX)\n      // && ((element.x + this.currentScroll) < this._scrollView.contentX + this._scrollView.renderStyles.contentWidth)\n    }\n  }\n\n}\n\n\nfunction generateSiblingNodeIndex(index, offset) {\n  let start = index - offset\n  let end = index + offset\n  let list = []\n  for (let i = start; i <= end; i++) {\n    list.push(i)\n  }\n  return list\n}\n","import View from './view'\nimport Text from './text'\nimport Image from './image'\nimport Layer from './layer'\nimport ScrollView from './scroll-view'\n\n/**\n * 生成一个element tree\n * @param {String} name\n * @param {Function} options\n */\n\nconst elementFactory = {}\n//\nregisterComponent('view', (options, children) => new View(options, children))\nregisterComponent('text', (options, children) => new Text(options, children))\nregisterComponent('image', (options, children) => new Image(options, children))\nregisterComponent('scroll-view', (options, children) => new ScrollView(options, children))\nregisterComponent('scrollview', (options, children) => new ScrollView(options, children))\n\nexport function createElement(model) {\n  // 生成树\n  function c(name, options = {}, children = []) {\n    // if (arguments.length < 3) {\n    //   throw Error(`Element [${name}]: need 3 argument but get 2`)\n    // }\n    let _element = null\n    let _children = children\n    if (elementFactory[name]) {\n      if (typeof children === 'string' && name !== 'text') {\n        // 支持text简写\n        _children = [new Text({}, children)]\n      } else if (!Array.isArray(children) && name !== 'text') {\n        throw Error(`Element [${name}]:Children must be type of Array!`)\n      }\n      _element = elementFactory[name](options, _children, c)\n    } else {\n      throw Error(`Unknown tag name [${name}] !`)\n    }\n    return _element\n  }\n  const _model = model(c)\n  // 挂载children\n  return _model\n}\n\nexport function createLayer(ctx, options) {\n  return new Layer(ctx, options)\n}\n\n// 注册全局组件\nexport function registerComponent(name, factory) {\n  if (elementFactory[name]) {\n    throw Error(`Already exist tag name [${name}] !`)\n  }\n  elementFactory[name] = factory\n}\n\n\n\n\n\n","\nimport { createElement, createLayer, registerComponent } from './create-element'\nimport px from './px'\nimport './weapp-adapter'\nimport View from './view'\nimport Text from './text'\nimport Image from './image'\nimport Layer from './layer'\nimport ScrollView from './scroll-view'\nimport { mergeOptions } from './utils'\n\n\nconst ef = {\n  createLayer,\n  createElement,\n  component: registerComponent,\n  View,\n  Text,\n  Image,\n  Layer,\n  ScrollView,\n  mergeOptions\n}\n\n\n\nexport default ef\n\n"],"names":["DISPLAY","BLOCK","INLINE_BLOCK","INLINE","FLEX","NONE","WIDTH","AUTO","OUTER","FLEX_DIRECTION","ROW","COLUMN","POSITION","ABSOLUTE","FIXED","RELATIVE","STATIC","DEFAULT_STYLES","display","fontSize","fontWeight","fontFamily","color","paddingTop","paddingBottom","paddingLeft","paddingRight","marginTop","marginBottom","marginLeft","marginRight","height","borderRadius","lineCap","flexDirection","verticalAlign","textAlign","justifyContent","alignItems","whiteSpace","zIndex","visible","position","TEXT_ALIGN","LEFT","RIGHT","CENTER","isExact","num","isAuto","isOuter","match","parseOuter","_n","parseInt","replace","isNaN","walk","element","callback","_continue","_next","_callContinue","_callNext","stack","push","length","item","pop","children","_getChildren","i","walkParent","cur","stop","callbreak","parent","isWX","window","breadthFirstSearch","node","nodes","queue","unshift","shift","_generateRender","breadthFirstSearchRight","reverse","mergeKeys","floor","val","Line","[object Object]","this","width","contentWidth","y","doorClosed","outerWidth","container","elements","start","end","offsetX","id","Math","random","el","initHeight","styles","Infinity","renderStyles","add","lineHeight","right","_getContainerLayout","contentX","x","getPreLine","initLayout","getOffsetY","line","refreshWidthHeight","next","closeLine","refreshXAlign","pre","_getPreLayout","contentY","KEY","STYLES","contentHeight","FlexBox","super","exactValue","flexTotal","key","calcFlex","flex","containerWidth","forEach","child","_refreshContentWithLayout","alignSelf","TreeNode","hasChildren","filter","map","index","_setParent","_setSibling","connectChildren","root","Array","isArray","treeNode","Error","indexOf","splice","removeChild","_completeFlex","isInFlow","_completeWidth","borderWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopWidth","overflow","_completeBorder","_completeFont","padding","margin","_completePaddingMargin","Element","options","Object","assign","attrs","on","render","_initStyles","initEvent","keys","eventName","getLayer","eventManager","EVENTS","includes","addEventListener","removeElement","layer","mountNode","_getDefaultStyles","_getParentStyles","_completeStyles","_initRenderStyles","parentWidth","parentHeight","paddingWidth","paddingHeight","_getTotalBorderWidth","_getTotalBorderHeight","_InFlexBox","_bindFlexBox","relativeTo","findRelativeTo","curStyles","extendStyles","completeStyles","ctx","layout","_measureLayout","_refreshLayoutWithContent","_bindLine","refreshElementPosition","top","bottom","left","canIEnter","bind","_getChildrenInFlow","value","appendChild","onElementAdd","prependChild","onElementRemove","append","prepend","_needReflow","reflowElement","getRender","requestRepaint","View","type","_drawBackground","_drawBox","Text","_layout","_lines","_drawText","measureText","fontHeight","_calcLine","textWidth","textHeight","parentContentWidth","text","lineIndex","lineText","lastLayout","maxLine","substring","undefined","$Image","_imageInfo","sx","sy","swidth","sheight","dx","dy","dwidth","dheight","debugColor","_image","init","_loadImage","_drawImage","mode","Promise","resolve","reject","getImageInstance","src","then","info","image","_layoutImage","isVisible","load","catch","err","error","imageW","imageH","w","h","getHeightByWidth","getWidthByHeight","originWidth","originHeight","events","EventManager","simulateClick","clear","touchStartEvent","event","Event","_emit","checkClick","deltaX","deltaY","e","tree","callbackList","curArr","walkArray","callBreak","isEnd","isPointInElement","relativeX","relativeY","runCapture","currentTarget","runCallback","cancelBubble","a1","a2","a3","a4","remove","isCapture","list","console","addCallback","target","p","Callback","addCapture","startx","starty","endx","endy","distance","click","captureList","params","call","arr","_break","angle","PI","CanvasRender","imageBus","isAnimate","lastPaintTime","lastFrameComplete","throttle","threshold","timer","fn","setTimeout","getThrottle","getCtx","save","restore","beginPath","closePath","_paint","afterPaint","_helpParentRestoreCtx","moveTo","arc","lineTo","borderColor","shadowBlur","borderStyle","shadowColor","backgroundColor","shadowOffsetX","shadowOffsetY","getBorderRadius","strokeStyle","lineJoin","setLineDash","stroke","lineWidth","_restore","_path","topBorder","rightBorder","bottomBorder","leftBorder","opacity","globalAlpha","fillStyle","fill","_clip","_parseBackground","fillRect","debug","strokeRect","clip","gradient","createLinearGradient","addColorStop","textIndent","textDecoration","font","_getFont","textBaseline","_x","_y","fillText","offset","decorationType","decorationY","drawImage","translate","currentScrollX","currentScrollY","getCanvas","createImage","warn","url","instance","onload","wx","downloadFile","res","getImageInfo","tempFilePath","res1","getImage","Image","Date","now","clearRect","renderNode","callContinue","callNext","paint","draw","animate","canvas","preTime","requestAnimationFrame","_animate","all","Layer","nodeList","p2cList","c2pList","renderList","initRender","startTime","initP2CList","initC2PList","flow","onEffectFinished","lifecycle","repaint","log","reflow","_initWidthHeight","_initPosition","onElementChange","beforePaint","callBeforePaint","readyToRender","getElementBy","arguments","name","arg","ScrollView","rest","direction","_scrollView","visibleIndex","renderOnDemand","initChildrenVisible","initScroll","_drawScroll","startX","startY","lastStartX","lastStartY","startMove","offsetY","speedX","speedY","glideInterval","resistanceX","resistanceY","scrollBy","stopPropagation","scrollTo","maxScrollX","maxScrollY","clearInterval","setInterval","offsetWidth","offsetHeight","scrollWidth","scrollHeight","calcScrollBoundX","calcScrollBoundY","calcChildrenVisible","scrollByX","scrollByY","isElementInViewport","head","generateSiblingNodeIndex","foot","elementFactory","registerComponent","factory","createLayer","createElement","model","c","_element","_children","component","mergeOptions","mergedOptions"],"mappings":"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"}